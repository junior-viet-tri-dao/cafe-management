<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="$CONTENT_TITLE - Cafe Management">Danh s√°ch giao d·ªãch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script th:src="@{/js/table-search.js}"></script>
    <script th:src="@{/js/alert-utils.js}"></script>
</head>

<body>
<div layout:fragment="content" class="container mt-5 mb-5">
    <div class="card shadow rounded-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-primary fw-bold">üìã Danh s√°ch giao d·ªãch</h2>
                <div class="btn-group">
                    <a th:href="@{/product}" class="btn btn-outline-danger">üì¶ H√†ng h√≥a</a>
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#confirmProductExistModal">‚ûï ƒê∆°n nh·∫≠p</button>
                    <a th:href="@{/inventory/export/new}" class="btn btn-outline-primary">‚ûï ƒê∆°n xu·∫•t</a>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <input type="text" id="searchInput"
                           class="form-control shadow-sm"
                           placeholder="üîç T√¨m theo t√™n h√†ng h√≥a..."
                           onkeyup="filterTable('searchInput', 'transactionTableBody', [0])"/>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered table-hover align-middle text-center shadow-sm">
                    <thead class="table-dark">
                    <tr>
                        <th style="min-width: 160px;">T√™n h√†ng h√≥a</th>
                        <th>Ng√†y nh·∫≠p</th>
                        <th>Ng√†y xu·∫•t</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>ƒê∆°n v·ªã t√≠nh</th>
                        <th>ƒê∆°n gi√°</th>
                        <th>T·ªïng ti·ªÅn</th>
                        <th>Lo·∫°i</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                    </thead>
                    <tbody id="transactionTableBody">
                    <tr th:each="tx : ${transactions}">
                        <td th:text="${tx.productName}">T√™n h√†ng</td>
                        <td th:text="${tx.importDate}">Ng√†y nh·∫≠p</td>
                        <td th:text="${tx.exportDate}">Ng√†y xu·∫•t</td>
                        <td th:text="${tx.quantity}">S·ªë l∆∞·ª£ng</td>
                        <td th:text="${tx.unitName}">ƒê∆°n v·ªã</td>
                        <td th:text="${tx.quantity > 0} ? ${#numbers.formatDecimal(tx.totalAmount / tx.quantity, 0, 'POINT', 0, 'COMMA')} + ' VNƒê' : '0 VNƒê'">ƒê∆°n gi√°</td>
                        <td th:text="${#numbers.formatDecimal(tx.totalAmount, 0, 'POINT', 0, 'COMMA')} + ' VNƒê'">T·ªïng ti·ªÅn</td>
                        <td>
                            <span th:if="${tx.type == 'IMPORT'}" class="badge bg-success">Nh·∫≠p</span>
                            <span th:if="${tx.type == 'EXPORT'}" class="badge bg-danger">Xu·∫•t</span>
                        </td>
                        <td>
                            <div class="d-flex justify-content-center gap-2 flex-wrap">
                                <a th:if="${tx.type == 'IMPORT'}" th:href="@{/inventory/import/edit/{id}(id=${tx.id})}" class="btn btn-sm btn-warning">‚úèÔ∏è S·ª≠a</a>
                                <a th:if="${tx.type == 'EXPORT'}" th:href="@{/inventory/export/edit/{id}(id=${tx.id})}" class="btn btn-sm btn-warning">‚úèÔ∏è S·ª≠a</a>

                                <form th:if="${tx.type == 'IMPORT'}"
                                      th:action="@{/inventory/import/delete/{id}(id=${tx.id})}"
                                      method="post"
                                      onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n nh·∫≠p n√†y?');"
                                      class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-danger">üóëÔ∏è X√≥a</button>
                                </form>

                                <form th:if="${tx.type == 'EXPORT'}"
                                      th:action="@{/inventory/export/delete/{id}(id=${tx.id})}"
                                      method="post"
                                      onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë∆°n xu·∫•t n√†y?');"
                                      class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-danger">üóëÔ∏è X√≥a</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(transactions)}">
                        <td colspan="9" class="text-center text-danger">Kh√¥ng c√≥ giao d·ªãch.</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="mt-4 text-center">
                <a th:href="@{/home}" class="btn btn-secondary">üîô Quay l·∫°i trang ch·ªß</a>
            </div>

            <!-- Modal x√°c nh·∫≠n -->
            <div class="modal fade" id="confirmProductExistModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-3 shadow">
                        <div class="modal-header">
                            <h5 class="modal-title text-primary fw-bold">üì¶ H√†ng h√≥a ƒë√£ c√≥ trong kho ch∆∞a?</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
                        </div>
                        <div class="modal-body">
                            <p>B·∫°n vui l√≤ng ch·ªçn m·ªôt trong hai l·ª±a ch·ªçn b√™n d∆∞·ªõi ƒë·ªÉ ti·∫øp t·ª•c th√™m ƒë∆°n nh·∫≠p:</p>
                            <ul>
                                <li><strong>Ch∆∞a c√≥</strong>: T·∫°o h√†ng h√≥a m·ªõi tr∆∞·ªõc khi nh·∫≠p.</li>
                                <li><strong>ƒê√£ c√≥</strong>: Nh·∫≠p h√†ng d·ª±a tr√™n s·∫£n ph·∫©m c√≥ s·∫µn.</li>
                            </ul>
                        </div>
                        <div class="modal-footer justify-content-between">
                            <a th:href="@{/product/new(redirectToImport=true)}" class="btn btn-outline-secondary">‚ûï Ch∆∞a c√≥</a>
                            <a th:href="@{/inventory/import/new}" class="btn btn-primary">‚úÖ ƒê√£ c√≥</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
</body>
</html>
