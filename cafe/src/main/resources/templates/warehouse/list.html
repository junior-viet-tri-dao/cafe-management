<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">
  <title>Danh sách hàng hóa</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
<div layout:fragment="content" class="max-w-7xl mx-auto px-4 py-6">
  <h2 class="text-2xl font-bold mb-6">Danh sách hàng hóa</h2>

  <!-- Tìm kiếm + Nút lịch sử -->
  <div class="flex flex-wrap items-center justify-between mb-6 gap-4">
    <form th:action="@{/warehouse/search}" method="get" class="flex items-center space-x-2">
      <input type="text" name="keyword" placeholder="Tìm kiếm hàng hóa..."
             th:value="${keyword}" class="px-4 py-2 border border-gray-300 rounded w-full max-w-md" />
      <button type="submit"
              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Tìm kiếm</button>
    </form>

    <!-- Nút lịch sử toàn bộ -->
    <div class="flex space-x-2">
      <a th:href="@{/warehouse/history/import}" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
        Lịch sử nhập
      </a>
      <a th:href="@{/warehouse/history/export}" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">
        Lịch sử xuất
      </a>
    </div>
  </div>

  <!-- Bảng dữ liệu -->
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-gray-200 rounded shadow">
      <thead class="bg-gray-200">
        <tr>
          <th class="px-4 py-2 text-left">Tên</th>
          <th class="px-4 py-2 text-left">Ngày nhập</th>
          <th class="px-4 py-2 text-left">Ngày xuất</th>
          <th class="px-4 py-2 text-left">Số lượng</th>
          <th class="px-4 py-2 text-left">Đơn vị</th>
          <th class="px-4 py-2 text-left">Đơn giá</th>
          <th class="px-4 py-2 text-left">Tổng tiền</th>
          <th class="px-4 py-2 text-left">Hành động</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="product : ${productPage.content}" class="border-t hover:bg-gray-50">
          <td class="px-4 py-2" th:text="${product.productName}">Tên sản phẩm</td>
          <td class="px-4 py-2" th:text="${product.lastImportDate != null ? #temporals.format(product.lastImportDate, 'dd/MM/yyyy') : '-'}">-</td>
          <td class="px-4 py-2" th:text="${product.lastExportDate != null ? #temporals.format(product.lastExportDate, 'dd/MM/yyyy') : '-'}">-</td>
          <td class="px-4 py-2" th:text="${product.currentQuantity}">0</td>
          <td class="px-4 py-2" th:text="${product.unitName}">Đơn vị</td>
          <td class="px-4 py-2" th:text="${product.latestPrice != null ? #numbers.formatDecimal(product.latestPrice, 1, 'COMMA', 0, 'POINT') : '0'}">0</td>
          <td class="px-4 py-2" th:text="${product.totalAmount != null ? #numbers.formatDecimal(product.totalAmount, 1, 'COMMA', 0, 'POINT') : '0'}">0</td>
          <td class="px-4 py-2 space-y-1">
            <a th:href="@{'/warehouse/edit/' + ${product.id}}" class="text-blue-600 hover:underline block">Sửa</a>
            <a th:href="@{'/warehouse/delete/' + ${product.id}}" onclick="return confirm('Bạn có chắc chắn muốn xóa không?')" class="text-red-600 hover:underline block">Xóa</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Phân trang -->
  <div class="mt-6 flex items-center justify-between">
    <span class="text-sm" th:text="'Trang ' + ${productPage.number + 1} + ' / ' + ${productPage.totalPages}">Trang 1 / 1</span>
    <div class="flex items-center space-x-1">
      <a th:if="${!productPage.first}"
         th:href="@{/warehouse(page=${productPage.number - 1}, size=${productPage.size})}"
         class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400">« Trước</a>

      <a th:each="i : ${#numbers.sequence(0, productPage.totalPages - 1)}"
         th:href="@{/warehouse(page=${i}, size=${productPage.size})}"
         th:text="${i + 1}"
         th:classappend="${productPage.number == i} ? 'bg-blue-600 text-white' : 'bg-gray-200 hover:bg-gray-300'"
         class="px-3 py-1 rounded">1</a>

      <a th:if="${!productPage.last}"
         th:href="@{/warehouse(page=${productPage.number + 1}, size=${productPage.size})}"
         class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400">Sau »</a>
    </div>
  </div>
</div>
</body>
</html>
