<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">
  <title>Danh sách nhân viên</title>
  <style>
    .table-header {
      background: linear-gradient(to right, #26c6da, #00acc1);
      color: white;
    }
  </style>
</head>
<body>
<div layout:fragment="content">
  <div class="bg-white shadow-xl rounded-xl p-8">
    <h2 class="text-3xl font-bold text-[#37474f] mb-6 flex items-center gap-2">
      <span>📋</span> Danh sách nhân viên
    </h2>

    <div class="mb-6 flex flex-col md:flex-row items-center gap-3">
      <input type="text" id="searchInput"
             placeholder="🔍 Nhập tên hoặc chức vụ..."
             class="w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-cyan-400"/>
      <button onclick="handleSearch()"
              class="bg-cyan-600 hover:bg-cyan-700 text-white font-semibold px-5 py-2 rounded-lg shadow">
        Tìm kiếm
      </button>
    </div>

    <div class="overflow-x-auto border border-gray-300 rounded-xl shadow">
      <table class="min-w-full divide-y divide-gray-200" id="employeeTable">
        <thead class="table-header text-sm uppercase tracking-wider">
        <tr>
          <th class="px-6 py-4 text-left">STT</th>
          <th class="px-6 py-4 text-left">Họ tên</th>
          <th class="px-6 py-4 text-left">Chức vụ</th>
          <th class="px-6 py-4 text-right">Lương</th>
          <th class="px-6 py-4 text-center">Thao tác</th>
        </tr>
        </thead>
        <tbody th:if="${listEmployee != null}" th:each="nv, i : ${listEmployee}"
               th:class="${i.index % 2 == 0} ? 'bg-white' : 'bg-gray-50'"
               class="text-sm text-gray-800 divide-y divide-gray-200">
        <tr class="hover:bg-yellow-50 transition duration-150 ease-in-out">
          <td class="px-6 py-4 font-semibold" th:text="${i.index + 1}">1</td>
          <td class="px-6 py-4 employee-name" th:text="${nv.getHoTen()}">Tên</td>
          <td class="px-6 py-4 employee-role" th:text="${nv.getChucVu()}">Chức vụ</td>
          <td class="px-6 py-4 text-right font-medium text-green-700"
              th:text="${#numbers.formatDecimal(nv.luong, 0, 'POINT', 0, 'COMMA')} + ' VNĐ'">0</td>
          <td class="px-6 py-4 text-center flex justify-center gap-2">
            <a th:href="@{/employee/edit/{id}(id=${nv.maNhanVien})}"
               class="bg-yellow-400 hover:bg-yellow-500 text-white text-xs font-semibold px-3 py-1 rounded shadow">
              ✏️ Sửa
            </a>

            <form th:action="@{/employee/delete/{id}(id=${nv.maNhanVien})}" method="post"
                  th:id="'deleteForm-' + ${nv.maNhanVien}">
              <button type="button"
                      th:attr="data-id=${nv.maNhanVien}"
                      class="btn-delete bg-red-500 hover:bg-red-600 text-white text-xs font-semibold px-3 py-1 rounded shadow">
                🗑️ Xóa
              </button>
            </form>

          </td>
        </tr>
        </tbody>
        <tbody th:if="${listEmployee == null or listEmployee.size() == 0}">
        <tr>
          <td colspan="4" class="text-center text-gray-400 py-6">Chưa có nhân viên nào.</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    function handleSearch() {
      const keyword = document.getElementById('searchInput').value.toLowerCase().trim();
      const rows = document.querySelectorAll('#employeeTable tbody tr');

      rows.forEach(row => {
        const name = row.querySelector('.employee-name')?.textContent.toLowerCase() || '';
        const role = row.querySelector('.employee-role')?.textContent.toLowerCase() || '';

        row.style.display = (name.includes(keyword) || role.includes(keyword)) ? '' : 'none';
      });
    }

    document.querySelectorAll('.btn-delete').forEach(button => {
      button.addEventListener('click', function () {
        const id = this.getAttribute('data-id');
        Swal.fire({
          title: 'Xác nhận xoá?',
          text: 'Bạn có chắc muốn xoá nhân viên này?',
          icon: 'question',
          showCancelButton: true,
          confirmButtonText: 'Có',
          cancelButtonText: 'Không',
          confirmButtonColor: '#16a34a',
          cancelButtonColor: '#ef4444'
        }).then((result) => {
          if (result.isConfirmed) {
            document.getElementById('deleteForm-' + id).submit();
          }
        });
      });
    });

  </script>
</div>
</body>
</html>
