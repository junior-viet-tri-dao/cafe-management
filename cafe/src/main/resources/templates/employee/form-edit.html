<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="$CONTENT_TITLE - Cafe Management">Ch·ªânh S·ª≠a Nh√¢n Vi√™n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://unpkg.com/flowbite@2.3.0/dist/flowbite.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/flowbite@2.3.0/dist/datepicker.js"></script>
    <script th:src="@{/js/alert-utils.js}"></script>
</head>

<body class="bg-[#fdf6e3] text-gray-800 font-sans flex flex-col min-h-screen">
<header th:replace="~{layout :: header}"></header>

<div class="flex flex-1">
    <aside th:replace="~{layout :: aside}"></aside>

    <main class="flex-1 p-10 bg-[#e0f7fa]" layout:fragment="content">
        <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-[#4e342e] mb-4 text-center">Ch·ªânh s·ª≠a nh√¢n vi√™n</h2>
            <form th:action="@{/employee/{id}(id=${employeeId})}" method="post" th:object="${employee}" class="space-y-4" enctype="multipart/form-data">
                <input type="hidden" th:field="*{id}" />

                <div>
                    <label class="block text-sm font-medium text-gray-700">* H·ªç v√† t√™n:</label>
                    <input type="text" th:field="*{fullName}"
                           required minlength="2" maxlength="100"
                           pattern="^[^\d]+$"
                           title="H·ªç t√™n kh√¥ng ch·ª©a s·ªë, t·ª´ 2 ƒë·∫øn 100 k√Ω t·ª±"
                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    <p class="text-sm text-red-500" th:if="${#fields.hasErrors('fullName')}"
                       th:errors="*{fullName}">L·ªói</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">* ƒê·ªãa ch·ªâ:</label>
                    <input type="text" th:field="*{address}" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required>
                    <p class="text-sm text-red-500" th:if="${#fields.hasErrors('address')}"
                       th:errors="*{address}">L·ªói</p>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="w-1/2">
                        <label class="block text-sm font-medium text-gray-700">* Ch·ª©c v·ª•:</label>
                        <select id="positionSelect"
                                th:field="*{positionId}"
                                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"
                                onchange="updateSalary()" required>
                        <option th:each="p : ${positions}"
                                th:value="${p.id}"
                                data-salary="${p.salary}"
                                th:text="${p.positionName}">
                            </option>
                        </select>
                    </div>

                    <div class="w-1/2">
                        <label class="block text-sm font-medium text-gray-700">* L∆∞∆°ng:</label>
                        <input type="text"
                               id="salaryInput"
                               readonly
                               th:value="${#numbers.formatDecimal(employee.salary, 0, 'POINT', 0, 'COMMA')} + ' VNƒê'"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">* S·ªë ƒëi·ªán tho·∫°i:</label>
                    <input type="tel" th:field="*{phoneNumber}"
                           required pattern="^0\d{9,10}$"
                           title="S·ªë ƒëi·ªán tho·∫°i ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng 0, g·ªìm 10‚Äì11 s·ªë"
                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                    <p class="text-sm text-red-500" th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}"></p>

                </div>

                <div class="flex justify-center space-x-4">
                    <button type="submit" class="px-4 py-2 bg-[#4e342e] text-white rounded-md hover:bg-[#3e2723]">üíæ L∆∞u</button>
                    <a th:href="@{/employee}" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400">‚ùå H·ªßy</a>
                </div>

                <p class="text-sm text-red-500 mt-2">(*): C√°c tr∆∞·ªùng b·∫Øt bu·ªôc nh·∫≠p</p>
            </form>
        </div>
    </main>
</div>

<footer th:replace="~{layout :: footer}"></footer>
<div th:replace="~{/alert :: alerts}"></div>
</body>
<script>
    function updateSalary() {
        const select = document.getElementById("positionSelect");
        const selectedOption = select.options[select.selectedIndex];
        const salary = selectedOption.getAttribute("data-salary");
        const formattedSalary = new Intl.NumberFormat('vi-VN').format(Number(salary || 0)) + " VNƒê";
        document.getElementById("salaryInput").value = formattedSalary;
    }

    window.addEventListener("DOMContentLoaded", () => {
        const select = document.getElementById("positionSelect");
        select.addEventListener("change", updateSalary);
        updateSalary(); // g·ªçi khi v·ª´a load trang
    });
</script>
</html>
