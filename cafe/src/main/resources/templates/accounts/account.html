<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Trang c√° nh√¢n</title>
</head>
<body>
<div layout:fragment="content">
    <form th:action="@{/account/update}" th:object="${account}" method="post"
          enctype="multipart/form-data"
          class="max-w-5xl mx-auto bg-white rounded-xl shadow-lg mt-10 p-8 space-y-8">

        <input type="hidden" th:field="*{id}" />

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Avatar + Logout -->
            <div class="flex flex-col items-center space-y-6">
                <div class="w-40 h-40 relative">
                    <img th:if="${account != null and account.imageUrl != null and !#strings.isEmpty(account.imageUrl)}"
                         th:src="@{${account.imageUrl}}"
                         alt="avatar"
                         class="w-40 h-40 rounded-full border-4 border-[#4e342e] shadow object-cover"/>
                    <img th:if="${account == null or account.imageUrl == null or #strings.isEmpty(account.imageUrl)}"
                         src="https://via.placeholder.com/160"
                         alt="avatar"
                         class="w-40 h-40 rounded-full border-4 border-[#4e342e] shadow object-cover"/>
                </div>

                <label class="text-sm font-medium text-gray-700 text-center w-full">
                    <span class="block mb-1">Thay ·∫£nh ƒë·∫°i di·ªán</span>
                    <input type="file" name="avatar" accept="image/*"
                           onchange="previewAvatar(event)"
                           class="block w-full text-sm file:mr-2 file:py-1 file:px-2
                                  file:rounded file:border-0 file:bg-yellow-500 file:text-white
                                  hover:file:bg-yellow-600"/>
                </label>

                <button type="submit" formaction="/logout"
                        class="bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded shadow w-full">
                    üö™ ƒêƒÉng xu·∫•t
                </button>
            </div>

            <!-- Th√¥ng tin c√° nh√¢n -->
            <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">

                <!-- H·ªç v√† t√™n -->
                <div class="flex flex-col">
                    <label class="font-semibold mb-1">H·ªç v√† t√™n</label>
                    <input type="text" th:field="*{fullName}" required minlength="5"
                           pattern="^(?!\\s*$).{5,}$"
                           class="w-full px-3 py-2 border rounded"/>
                    <p th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}" class="text-red-600 text-sm mt-1"></p>
                </div>

                <!-- Ch·ª©c v·ª• -->
                <div class="flex flex-col">
                    <label class="font-semibold mb-1">Ch·ª©c v·ª•</label>
                    <input type="text" th:field="*{positionName}" readonly
                           class="w-full px-3 py-2 border rounded bg-gray-100"/>
                </div>

                <!-- ƒê·ªãa ch·ªâ -->
                <div class="flex flex-col md:col-span-2">
                    <label class="font-semibold mb-1">ƒê·ªãa ch·ªâ</label>
                    <input type="text" th:field="*{address}"
                           class="w-full px-3 py-2 border rounded"/>
                    <p th:if="${#fields.hasErrors('address')}" th:errors="*{address}" class="text-red-600 text-sm mt-1"></p>
                </div>

                <!-- S·ªë ƒëi·ªán tho·∫°i -->
                <div class="flex flex-col">
                    <label class="font-semibold mb-1">S·ªë ƒëi·ªán tho·∫°i</label>
                    <input type="text" th:field="*{phoneNumber}" required
                           pattern="^0\\d{9,10}$"
                           maxlength="11"
                           class="w-full px-3 py-2 border rounded"/>
                    <p th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}" class="text-red-600 text-sm mt-1"></p>
                </div>

                <!-- L∆∞∆°ng -->
                <div class="flex flex-col">
                    <label class="font-semibold mb-1">L∆∞∆°ng</label>
                    <input type="text"
                           th:value="${account.salary != null ? #numbers.formatDecimal(account.salary, 0, 'POINT', 0, 'COMMA') : 'Ch∆∞a c√≥ th√¥ng tin'}"
                           readonly class="w-full px-3 py-2 border rounded bg-gray-100"/>
                    <input type="hidden" th:field="*{salary}"/>
                </div>

                <!-- T√†i kho·∫£n -->
                <div class="flex flex-col">
                    <label class="font-semibold mb-1">T√†i kho·∫£n</label>
                    <input type="text" th:field="*{username}" readonly
                           class="w-full px-3 py-2 border rounded bg-gray-100"/>
                </div>

                <!-- M·∫≠t kh·∫©u -->
                <div class="flex flex-col">
                    <label class="font-semibold mb-1">M·∫≠t kh·∫©u</label>
                    <input type="password" th:field="*{password}"
                           placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (n·∫øu mu·ªën ƒë·ªïi)"
                           class="w-full px-3 py-2 border rounded"/>
                    <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="text-red-600 text-sm mt-1"></p>
                </div>
            </div>
        </div>

        <!-- N√∫t l∆∞u -->
        <div class="flex justify-end">
            <button type="submit"
                    class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded font-semibold shadow">
                üíæ L∆∞u th√¥ng tin
            </button>
        </div>
    </form>

    <!-- Preview Avatar Script -->
    <script>
        function previewAvatar(event) {
            const input = event.target;
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = input.closest('div').parentElement.querySelector('img');
                    img.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</div>
</body>
</html>
