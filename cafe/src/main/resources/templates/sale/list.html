<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Danh sách bàn</title>
</head>
<body>
<div layout:fragment="content" class="bg-[#fefae0] min-h-screen w-full px-6 py-8">

    <h2 class="text-2xl font-bold mb-4">Danh sách bàn</h2>

    <!-- Danh sách bàn -->
    <table border="1" class="w-full bg-white shadow">
        <thead>
        <tr class="bg-gray-200 text-left">
            <th class="p-2">Chọn</th>
            <th class="p-2">Tên bàn</th>
            <th class="p-2">Trạng thái</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="table : ${tables}">
            <td class="p-2 text-center">
                <input type="radio" name="selectedTable" th:value="${table.id}" onchange="selectTable(this)">
            </td>
            <td class="p-2" th:text="${table.tableName}">Tên bàn</td>
            <td class="p-2" th:text="${table.status}">Trạng thái</td>
        </tr>
        </tbody>
    </table>

    <!-- Hàng nút 1 -->
    <div class="mt-6 flex flex-wrap gap-4 justify-center">
        <a id="btn-view" href="#" class="btn disabled">👁 Xem bàn</a>
        <a id="btn-transfer" href="#" class="btn disabled">🔁 Chuyển bàn</a>
        <a id="btn-split" href="#" class="btn disabled">✂️ Tách bàn</a>
        <a id="btn-merge" href="#" class="btn disabled">➕ Gộp bàn</a>
        <form id="form-clear" method="post" th:action="@{/sale/clear}">
            <input type="hidden" name="tableId" id="clear-table-id">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" id="btn-clear" class="btn disabled"
                    onclick="return confirm('Bạn có chắc chắn muốn hủy bàn này?');">
                ❌ Hủy bàn
            </button>
        </form>
        <a id="btn-booking" href="#" class="btn disabled">📅 Đặt bàn</a>
    </div>

    <!-- Hàng nút 2 -->
    <div class="mt-3 flex flex-wrap gap-4 justify-center">
        <a id="btn-menu" href="#" class="btn disabled">🍽 Chọn thực đơn</a>
        <a id="btn-payment" href="#" class="btn disabled">💰 Thanh toán</a>
    </div>

    <!-- Phân trang -->
    <div class="mt-6">
        <ul style="display: flex; gap: 10px; list-style: none;">
            <li th:if="${currentPage > 0}">
                <a th:href="@{/sale(page=${currentPage - 1})}">« Trước</a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:href="@{/sale(page=${i})}"
                   th:text="${i + 1}"
                   th:classappend="${i == currentPage} ? 'active' : ''"></a>
            </li>
            <li th:if="${currentPage < totalPages - 1}">
                <a th:href="@{/sale(page=${currentPage + 1})}">Sau »</a>
            </li>
        </ul>
    </div>

    <!-- CSS và Script -->
    <style>
        a.active {
            font-weight: bold;
            color: red;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #4a90e2;
            color: white;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }

        .btn:hover:not(.disabled) {
            background-color: #357ab7;
        }

        .disabled {
            pointer-events: none;
            opacity: 0.5;
        }
    </style>

    <script>
        function selectTable(radio) {
            const tableId = radio.value;
            document.getElementById("btn-view").href = `/sale/${tableId}/menu`;
            document.getElementById("btn-booking").href = `/booking?tableId=${tableId}`;
            document.getElementById("btn-menu").href = `/sale/invoice/create-or-get?tableId=${tableId}`;
            document.getElementById("btn-transfer").href = `/sale/transfer-table?from=${tableId}`;
            document.getElementById("btn-merge").href = `/sale/merge-tables?tableIds=${tableId}`;
            document.getElementById("btn-split").href = `/sale/split?fromTableId=${tableId}`;
            document.getElementById("btn-payment").href = `/payment/${tableId}`;
            document.getElementById("clear-table-id").value = tableId;

            // Kích hoạt tất cả các nút
            const btns = ["btn-view", "btn-booking", "btn-menu", "btn-transfer", "btn-merge", "btn-split", "btn-clear", "btn-payment"];
            btns.forEach(id => document.getElementById(id).classList.remove("disabled"));
        }
    </script>

</div>
</body>
</html>