<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch b√†n</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        a.active {
            font-weight: bold;
            color: red;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #4a90e2;
            color: white;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:hover:not(.disabled) {
            background-color: #357ab7;
            transform: translateY(-2px);
        }

        .disabled {
            pointer-events: none;
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Styling for the table cards */
        .table-card {
            background-color: #f0f0f0; /* Default light grey background for visibility */
            border-radius: 0.75rem; /* Rounded corners */
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            border: 2px solid transparent; /* Default border */
        }

        .table-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .table-card.selected {
            border-color: #4a90e2; /* Highlight selected card */
            box-shadow: 0 0 0 3px #4a90e2, 0 8px 15px rgba(0, 0, 0, 0.15); /* Blue glow */
        }

        /* Updated colors for table statuses based on new terms */
        .table-card.status-OCCUPIED {
            background-color: #ffe0e0 !important; /* Softer red for occupied */
            border-color: #dc2626 !important; /* Stronger red border */
            color: #7f1d1d; /* Darker text for contrast */
        }

        .table-card.status-AVAILABLE {
            background-color: #e0ffe0 !important; /* Softer green for available */
            border-color: #16a34a !important; /* Stronger green border */
            color: #14532d; /* Darker text for contrast */
        }

        .table-card.status-RESERVED {
            background-color: #fff8e0 !important; /* Softer orange for reserved */
            border-color: #d97706 !important; /* Stronger orange border */
            color: #78350f; /* Darker text for contrast */
        }
    </style>
</head>
<body>
<div layout:fragment="content" class="bg-[#fefae0] min-h-screen w-full px-6 py-8">

    <h2 class="text-3xl font-extrabold text-gray-800 mb-6 text-center">Danh s√°ch b√†n</h2>

    <!-- Grid layout for tables -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 mb-8">
        <div th:each="table : ${tables}"
             th:data-table-id="${table.id}"
             th:data-table-status="${table.status}"
             th:classappend="'status-' + ${table.status}"
             class="table-card flex flex-col items-center justify-center p-6 text-center"
             onclick="selectTable(this)">
            <p class="text-xl font-semibold mb-2" th:text="${table.tableName}">T√™n b√†n</p>
            <p class="text-md font-medium" th:text="${table.status}">Tr·∫°ng th√°i</p>
        </div>
    </div>

    <!-- H√†ng n√∫t 1 -->
    <div class="mt-6 flex flex-wrap gap-4 justify-center">
        <a id="btn-view" href="#" class="btn disabled">üëÅ Xem b√†n</a>
        <a id="btn-transfer" href="#" class="btn disabled">üîÅ Chuy·ªÉn b√†n</a>
        <a id="btn-split" href="#" class="btn disabled">‚úÇÔ∏è T√°ch b√†n</a>
        <a id="btn-merge" href="#" class="btn disabled">‚ûï G·ªôp b√†n</a>
        <form id="form-clear" method="post" th:action="@{/sale/clear}">
            <input type="hidden" name="tableId" id="clear-table-id">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" id="btn-clear" class="btn disabled"
                    onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy b√†n n√†y?');">
                ‚ùå H·ªßy b√†n
            </button>
        </form>
        <a id="btn-booking" href="#" class="btn disabled">üìÖ ƒê·∫∑t b√†n</a>
    </div>

    <!-- H√†ng n√∫t 2 -->
    <div class="mt-3 flex flex-wrap gap-4 justify-center">
        <a id="btn-menu" href="#" class="btn disabled">üçΩ Ch·ªçn th·ª±c ƒë∆°n</a>
        <a id="btn-payment" href="#" class="btn disabled">üí∞ Thanh to√°n</a>
    </div>

    <!-- Ph√¢n trang -->
    <div class="mt-8 flex justify-center">
        <ul class="flex gap-4 list-none p-0 m-0">
            <li th:if="${currentPage > 0}">
                <a th:href="@{/sale(page=${currentPage - 1})}" class="text-blue-600 hover:text-blue-800 font-medium">¬´ Tr∆∞·ªõc</a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:href="@{/sale(page=${i})}"
                   th:text="${i + 1}"
                   th:classappend="${i == currentPage} ? 'active text-red-600 font-bold' : 'text-blue-600 hover:text-blue-800 font-medium'"></a>
            </li>
            <li th:if="${currentPage < totalPages - 1}">
                <a th:href="@{/sale(page=${currentPage + 1})}" class="text-blue-600 hover:text-blue-800 font-medium">Sau ¬ª</a>
            </li>
        </ul>
    </div>

    <script>
        let currentSelectedTableCard = null; // To keep track of the currently selected card

        function selectTable(clickedCard) {
            const tableId = clickedCard.dataset.tableId;
            const tableStatus = clickedCard.dataset.tableStatus;

            // Log the status to the console for debugging
            console.log("Selected Table ID:", tableId);
            console.log("Selected Table Status:", tableStatus);

            // Remove 'selected' class from previously selected card
            if (currentSelectedTableCard) {
                currentSelectedTableCard.classList.remove("selected");
            }

            // Add 'selected' class to the newly clicked card
            clickedCard.classList.add("selected");
            currentSelectedTableCard = clickedCard; // Update the reference

            // Update button hrefs with the selected tableId
            document.getElementById("btn-view").href = `/sale/${tableId}/menu`;
            document.getElementById("btn-booking").href = `/booking?tableId=${tableId}`;
            document.getElementById("btn-menu").href = `/sale/invoice/create-or-get?tableId=${tableId}`;
            document.getElementById("btn-transfer").href = `/sale/transfer-table?from=${tableId}`;
            document.getElementById("btn-merge").href = `/sale/merge-tables?tableIds=${tableId}`;
            document.getElementById("btn-split").href = `/sale/split?fromTableId=${tableId}`;
            document.getElementById("btn-payment").href = `/payment/${tableId}`;
            document.getElementById("clear-table-id").value = tableId;

            // Enable ALL buttons when a table is selected
            const btns = ["btn-view", "btn-transfer", "btn-split", "btn-merge", "btn-clear", "btn-booking", "btn-menu", "btn-payment"];
            btns.forEach(id => {
                const button = document.getElementById(id);
                button.classList.remove("disabled");
            });
        }
    </script>

</div>
</body>
</html>
