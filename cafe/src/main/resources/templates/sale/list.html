<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Danh sách bàn</title>
    <meta charset="UTF-8">
</head>
<body>
<h2>Danh sách bàn</h2>

<table border="1">
    <tr>
        <th>Tên bàn</th>
        <th>Trạng thái</th>
        <th>Hành động</th>
    </tr>
    <tr th:each="table : ${tables}">
        <td th:text="${table.tableName}">Tên bàn</td>
        <td th:text="${table.status}">Trạng thái</td>
        <td>
            <!-- Xem bàn -->
            <a th:href="@{/sale/{id}/menu(id=${table.id})}">
                <button type="button">Xem bàn</button>
            </a>

            <!-- Đặt bàn -->
            <a th:href="@{/booking(tableId=${table.id})}">
                <button>Đặt bàn</button>
            </a>
	            <<a th:href="@{/sale/invoice/create-or-get(tableId=${table.id})}"
				   th:if="${#lists.contains({'AVAILABLE','RESERVED','OCCUPIED'}, table.status.name())}"
				   class="btn btn-primary">
				    Chọn thực đơn
				</a>
				
				<a th:href="@{/sale/transfer-table(from=${table.id})}">
			        <button type="button">Chuyển bàn</button>
			    </a>
			    
			    <div class="mt-4">
				    <a th:href="@{/sale/merge-tables}" class="inline-block px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
				        ➕ Gộp bàn
				    </a>
				</div>

				<!-- Nút Hủy Bàn -->
					<form th:action="@{/sale/clear}" method="post" style="display:inline"
					      onsubmit="return confirm('Bạn có chắc chắn muốn hủy bàn này?');">
					    <input type="hidden" name="tableId" th:value="${table.id}" />
					    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					    <button type="submit"
					            class="bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded">
					        Hủy Bàn
					    </button>
					</form>

							
				 <a th:href="@{'/payment/' + ${table.id}}">
                <button type="button">Thanh toán</button>
           		 </a>
	
        </td>
    </tr>
</table>

<!-- Phân trang -->
<div>
    <ul style="display: flex; gap: 10px; list-style: none;">
        <li th:if="${currentPage > 0}">
            <a th:href="@{/sale(page=${currentPage - 1})}">« Trước</a>
        </li>
        <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
            <a th:href="@{/sale(page=${i})}"
               th:text="${i + 1}"
               th:classappend="${i == currentPage} ? 'active' : ''"></a>
        </li>
        <li th:if="${currentPage < totalPages - 1}">
            <a th:href="@{/sale(page=${currentPage + 1})}">Sau »</a>
        </li>
    </ul>
</div>

<style>
    a.active {
        font-weight: bold;
        color: red;
    }

    .btn.btn-primary {
        padding: 5px 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        text-decoration: none;
        cursor: pointer;
    }

    .btn.btn-primary:hover {
        background-color: #0056b3;
    }
</style>

</body>
</html>
