<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title layout:fragment="title">Ch·ªçn m√≥n</title>

    <script th:inline="javascript">
        let menuItems = /*[[${menuItems}]]*/ [];

        function addMenuRow() {
            const tableBody = document.getElementById("menuTableBody");
            const rowCount = tableBody.rows.length;

            const newRow = document.createElement("tr");

            const menuOptions = menuItems.map(item =>
                `<option value="${item.id}" data-price="${item.currentPrice}">${item.itemName}</option>`
            ).join("");

            newRow.innerHTML = `
                <td>
                    <select class="form-select" name="invoiceDetails[${rowCount}].menuItemId"
                            onchange="updatePrice(this, ${rowCount})" required>
                        <option value="">-- Ch·ªçn m√≥n --</option>
                        ${menuOptions}
                    </select>
                </td>
                <td>
                    <input type="number" class="form-control"
                           name="invoiceDetails[${rowCount}].price"
                           id="price-${rowCount}" step="0.01" readonly placeholder="Gi√° (VNƒê)">
                </td>
                <td>
                    <input type="number" class="form-control" min="0"
                           name="invoiceDetails[${rowCount}].quantity"
                           placeholder="S·ªë l∆∞·ª£ng" required>
                </td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">X√≥a</button>
                </td>
            `;

            tableBody.appendChild(newRow);
        }

        function removeRow(button) {
            const row = button.closest("tr");
            row.remove();
        }

        function updatePrice(selectElement, index) {
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            const price = selectedOption.getAttribute("data-price") || "";
            document.getElementById("price-" + index).value = price;
        }
    </script>
</head>
<body>
<main layout:fragment="content">
    <div class="container my-5">
        <h2 class="text-center text-primary mb-4">üçΩÔ∏è Ch·ªçn m√≥n cho <span th:text="${table.tableName}">B√†n</span></h2>

        <form method="post" th:action="@{/sale/select}" th:object="${invoiceRequest}">
            <input type="hidden" th:field="*{tableId}" />

            <table class="table table-bordered align-middle">
                <thead class="table-primary">
                <tr>
                    <th>M√≥n</th>
                    <th>Gi√°</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody id="menuTableBody">
                <!-- Ban ƒë·∫ßu tr·ªëng -->
                </tbody>
            </table>

            <button type="button" class="btn btn-outline-primary mb-3" onclick="addMenuRow()">+ Th√™m m√≥n</button>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success">‚úÖ X√°c nh·∫≠n ch·ªçn m√≥n</button>
                <a th:href="@{/sale}" class="btn btn-secondary">‚¨Ö Quay l·∫°i</a>
            </div>
        </form>
    </div>
</main>
</body>
</html>
