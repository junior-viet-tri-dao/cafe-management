<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Trang Danh S√°ch khuy·ªÖn m√£i </title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 font-sans bg-gray-50 text-gray-800">

<div layout:fragment="content">


    <form method="get" th:action="@{/promotion}" class="flex items-center gap-2 mb-4">
        <input type="text" name="namePromotion" placeholder="T√¨m theo t√™n h√†ng ho√°"
               th:value="${param.namePromotion}" class="px-3 py-2 border border-gray-300 rounded-md text-sm w-72">
        <button type="submit"
                class="bg-green-600 hover:bg-green-700 text-white text-sm font-semibold px-4 py-2 rounded-md shadow transition">
            üîç T√¨m
        </button>
    </form>

    <!-- Hi·ªÉn th·ªã th√¥ng b√°o t√¨m ki·∫øm n·∫øu c√≥ -->
    <div class="mb-4 text-sm text-gray-600 italic" th:if="${param.namePromotion}">
        ƒêang t√¨m v·ªõi t·ª´ kh√≥a: "<span th:text="${param.namePromotion}"></span>"
    </div>



    <div class="max-w-6xl mx-auto">
        <div class="overflow-x-auto shadow border border-gray-200 rounded-lg">
            <div class="min-w-full divide-y divide-gray-200">
                <!-- Table Header -->
                <div class="flex bg-gray-100 font-semibold text-sm uppercase tracking-wide text-gray-700">
                    <div class="flex-2 px-4 py-3 cursor-pointer hover:bg-gray-200" data-sort-by="namePromotion">
                        Id ƒê∆°n Nh·∫≠p <span class="sort-arrow inline-block ml-1"></span>
                    </div>
                    <div class="flex-1.5 px-4 py-3 cursor-pointer hover:bg-gray-200" data-sort-by="DateStart">
                        Ng√†y nh·∫≠p <span class="sort-arrow inline-block ml-1"></span>
                    </div>
                    <div class="flex-1 px-4 py-3 cursor-pointer text-right hover:bg-gray-200" data-sort-by="DataEnd">
                        Ng√†y xu·∫•t <span class="sort-arrow inline-block ml-1"></span>
                    </div>
                    <div class="flex-1 px-4 py-3 cursor-pointer text-right hover:bg-gray-200" data-sort-by="percentDiscount">
                       % gi·∫£m gi√° <span class="sort-arrow inline-block ml-1"></span>
                    </div>
                    <div class="flex-1 px-4 py-3">Action</div>
                </div>

                <div th:each="promotion : ${promotions.promotionPage}" class="flex items-center border-t border-gray-200 hover:bg-gray-50">
                    <div class="flex-2 px-4 py-3" th:text="${promotion.promotionName}"></div>
                    <div class="flex-1.5 px-4 py-3"  th:text="${#temporals.format(promotion.startDate, 'dd/MM/yyyy')}"></div>
                    <div class="flex-1 px-4 py-3 text-right" th:text="${#temporals.format(promotion.endDate, 'dd/MM/yyyy')}"></div>
                    <div class="flex-1 px-4 py-3 text-right" th:text="${promotion.discountValue}"></div>
                    <div class="flex-1 px-4 py-3 space-x-2">
                        <a th:href="@{/promotion/edit/{id}(id=${promotion.id})}" class="text-blue-600 hover:underline">Edit</a>
                        <a th:href="@{/promotion/delete/{id}(id=${promotion.id})}" class="text-red-600 hover:underline">Delete</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Ph√¢n trang -->
        <div class="flex items-center justify-between mt-8">
            <!-- Hi·ªÉn th·ªã s·ªë l∆∞·ª£ng -->
            <div class="text-sm text-gray-600" th:if="${promotions.totalPages > 0}">
                <span th:text="'Trang ' + (${promotions.pageNumber + 1}) + ' / ' + ${promotions.totalPages}">Trang 1 / 5</span> |
                <span th:text="'T·ªïng: ' + ${promotions.totalElements} + ' khuy·∫øn m√£i'">T·ªïng: 25 nh√¢n vi√™n</span>
            </div>

            <!-- Danh s√°ch n√∫t ph√¢n trang -->
            <nav>
                <ul class="inline-flex items-center space-x-1">
                    <!-- N√∫t Tr∆∞·ªõc -->
                    <li>
                        <a th:href="@{/promotion(page=${promotions.pageNumber - 1}, keyword=${param.namePromotion})}"
                           th:class="'flex items-center px-3 py-2 rounded-lg border text-sm transition ' + (${promotions.pageNumber == 0} ? 'text-gray-300 border-gray-300 bg-gray-100 cursor-not-allowed pointer-events-none' : 'text-blue-600 border-blue-300 hover:bg-blue-50')">
                            ‚óÄ Tr∆∞·ªõc
                        </a>
                    </li>

                    <!-- C√°c s·ªë trang -->
                    <li th:if="${promotions.totalPages > 0}"
                        th:each="pageNum : ${#numbers.sequence(0, promotions.totalPages - 1)}">
                        <a th:href="@{/promotion(page=${pageNum}, keyword=${param.namePromotion})}"
                           th:text="${pageNum + 1}"
                           th:class="'px-3 py-2 rounded-lg border text-sm font-medium transition ' +
                             (${pageNum} == ${promotions.pageNumber}
                             ? 'bg-blue-600 text-white border-blue-600'
                             : 'border-gray-300 text-gray-700 hover:bg-blue-50')">
                        </a>
                    </li>

                    <!-- N√∫t Ti·∫øp -->
                    <li>
                        <a th:href="@{/promotion(page=${promotions.pageNumber + 1}, keyword=${param.namePromotion})}"
                           th:class="'flex items-center px-3 py-2 rounded-lg border text-sm transition ' + (${promotions.pageNumber + 1 >= promotions.totalPages} ? 'text-gray-300 border-gray-300 bg-gray-100 cursor-not-allowed pointer-events-none' : 'text-blue-600 border-blue-300 hover:bg-blue-50')">
                            Ti·∫øp ‚ñ∂
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Sort Script gi·ªØ nguy√™n -->
    <script>
        const employeeTable = document.getElementById('employeeTable') || document.querySelector('.min-w-full');
        const headerCells = document.querySelectorAll('[data-sort-by]');
        let currentSortColumn = null;
        let currentSortDirection = 'asc';

        function getCellValue(row, columnIndex) {
            const cells = Array.from(row.querySelectorAll('div'));
            const cell = cells[columnIndex];
            if (cell.classList.contains('text-right')) {
                return parseFloat(cell.dataset.value);
            }
            return cell.textContent.trim();
        }

        function sortDivTable(columnIndex, direction) {
            const tableRows = Array.from(document.querySelectorAll('.flex.items-center'));
            tableRows.sort((a, b) => {
                let valA = getCellValue(a, columnIndex);
                let valB = getCellValue(b, columnIndex);
                if (typeof valA === 'string') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }
                return direction === 'asc' ? (valA > valB ? 1 : -1) : (valA < valB ? 1 : -1);
            });
            const container = tableRows[0].parentElement;
            tableRows.forEach(row => container.appendChild(row));
        }

        headerCells.forEach((header, index) => {
            header.addEventListener('click', () => {
                const column = header.dataset.sortBy;
                currentSortDirection = (currentSortColumn === column && currentSortDirection === 'asc') ? 'desc' : 'asc';
                currentSortColumn = column;
                document.querySelectorAll('.sort-arrow').forEach(a => a.textContent = '');
                header.querySelector('.sort-arrow').textContent = currentSortDirection === 'asc' ? '‚ñ≤' : '‚ñº';
                sortDivTable(index, currentSortDirection);
            });
        });
    </script>
</div>
</body>
</html>
