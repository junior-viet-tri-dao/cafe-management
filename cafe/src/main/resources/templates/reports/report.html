<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}">

<head>
  <meta charset="UTF-8">
  <title>Th·ªëng k√™, b√°o c√°o</title>
</head>

<body>
  <div layout:fragment="content">
    <div class="bg-white shadow-xl rounded-xl p-6 mt-6 max-w-7xl mx-auto">
      <h2 class="text-2xl font-bold text-[#4e342e] mb-6">üìä Th·ªëng k√™ & B√°o c√°o</h2>

      <!-- B·ªô l·ªçc th·ªëng k√™ -->
      <form th:action="@{/report}" method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 items-end"
        id="reportFilterForm" onsubmit="return validateDateFilter()">
        <!-- Ch·ªçn m·ª•c -->
        <div class="md:col-span-2">
          <label class="block font-semibold text-gray-700 mb-1">Ch·ªçn m·ª•c:</label>
          <select name="category" class="w-full border border-gray-300 px-3 py-2 rounded-md">
            <option value="all">T·∫•t c·∫£</option>
            <option value="import_export">Nh·∫≠p - Xu·∫•t</option>
            <option value="import">Nh·∫≠p</option>
            <option value="sell">B√°n h√†ng</option>
            <option value="salary">L∆∞∆°ng</option>
            <option value="staff">TT nh√¢n vi√™n</option>
            <option value="export">Xu·∫•t</option>
            <option value="other">Ph√≠ kh√°c</option>
          </select>
        </div>


        <!-- T·ª´ ng√†y -->
        <div>
          <label class="block font-semibold text-gray-700 mb-1">T·ª´ ng√†y:</label>
          <input type="date" name="fromDate" id="fromDate"
            class="w-full border border-gray-300 px-3 py-2 rounded-md focus:ring-2 focus:ring-blue-500"
            th:value="${filter.fromDate}" />
          <div th:if="${#fields.hasErrors('fromDate')}" class="text-red-600 text-sm mt-1" th:errors="*{fromDate}"></div>
        </div>

        <!-- ƒê·∫øn ng√†y -->
        <div>
          <label class="block font-semibold text-gray-700 mb-1">ƒê·∫øn ng√†y:</label>
          <input type="date" name="toDate" id="toDate"
            class="w-full border border-gray-300 px-3 py-2 rounded-md focus:ring-2 focus:ring-blue-500"
            th:value="${filter.toDate}" />
          <div th:if="${#fields.hasErrors('toDate')}" class="text-red-600 text-sm mt-1" th:errors="*{toDate}"></div>
        </div>

        <div class="md:col-span-4 text-right mt-2">
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-md">
            Xem b√°o c√°o
          </button>
        </div>
        <div class="md:col-span-4 mt-2">
          <span id="dateErrorMsg" class="text-red-600 font-semibold hidden"></span>
          <div th:if="${#fields.hasGlobalErrors()}" class="text-red-600 text-sm mt-1" th:errors="*{filter}"></div>
        </div>
      </form>

      <!-- Th√¥ng b√°o n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu -->
      <div th:if="${#lists.isEmpty(reportList)}" class="mt-6 text-center text-red-600 font-semibold">
        Kh√¥ng c√≥ d·ªØ li·ªáu b√°o c√°o ph√π h·ª£p v·ªõi b·ªô l·ªçc!
      </div>
      <!-- B·∫£ng k·∫øt qu·∫£ -->
      <div class="overflow-x-auto mt-6" th:if="${not #lists.isEmpty(reportList)}">
        <table class="min-w-full table-auto border border-gray-300 rounded-lg">
          <thead class="bg-blue-100 text-gray-800 text-sm font-bold uppercase">
            <tr>
              <th class="px-4 py-2 text-center">Ng√†y</th>
              <th class="px-4 py-2 text-right">Thu</th>
              <th class="px-4 py-2 text-right">Chi</th>
            </tr>
          </thead>
          <tbody class="text-sm text-gray-700 divide-y divide-gray-200">
            <tr th:each="item : ${reportList}">
              <td class="px-4 py-2 text-center" th:text="${item.ngay}">23/12/2014</td>
              <td class="px-4 py-2 text-right" th:text="${#numbers.formatDecimal(item.thu, 0, 'POINT', 0, 'COMMA')}">
                1.000.000</td>
              <td class="px-4 py-2 text-right" th:text="${#numbers.formatDecimal(item.chi, 0, 'POINT', 0, 'COMMA')}">
                500.000</td>
            </tr>
            <tr class="font-bold bg-gray-50">
              <td class="px-4 py-2 text-center">T·ªïng</td>
              <td class="px-4 py-2 text-right" th:text="${tongThu}">3.000.000</td>
              <td class="px-4 py-2 text-right" th:text="${tongChi}">1.600.000</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Xu·∫•t file & In file -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-10">
        <!-- Xu·∫•t file -->
        <form th:action="@{/report/export}" method="get" class="border rounded-lg p-4 bg-gray-50">
          <h3 class="text-lg font-semibold mb-3">üìÅ Xu·∫•t file</h3>
          <div class="space-y-2">
            <label><input type="radio" name="fileFormat" value="txt" class="mr-2" required> .txt - Text
              File</label><br />
            <label><input type="radio" name="fileFormat" value="xls" class="mr-2"> .xls - Excel File</label><br />
            <label><input type="radio" name="fileFormat" value="sql" class="mr-2"> .sql - SQL File</label>
          </div>
          <!-- Truy·ªÅn l·∫°i filter n·∫øu c√≥ -->
          <input type="hidden" name="category" th:value="${param.category}" />
          <input type="hidden" name="fromDate" th:value="${param.fromDate}" />
          <input type="hidden" name="toDate" th:value="${param.toDate}" />
          <button type="submit" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-md">
            Xu·∫•t file
          </button>
        </form>

        <!-- In file -->
        <form th:action="@{/report/print}" method="get" class="border rounded-lg p-4 bg-gray-50">
          <h3 class="text-lg font-semibold mb-3">üñ®Ô∏è In file</h3>
          <div class="space-y-3">
            <div>
              <label class="block font-medium mb-1">Kh·ªï gi·∫•y:</label>
              <select name="paperSize" class="w-full border border-gray-300 px-3 py-2 rounded-md">
                <option value="A4">A4</option>
                <option value="A5">A5</option>
                <option value="Letter">Letter</option>
              </select>
            </div>
            <div>
              <label class="block font-medium mb-1">M√°y in:</label>
              <select name="printer" class="w-full border border-gray-300 px-3 py-2 rounded-md">
                <option value="Hp Laser">Hp Laser</option>
                <option value="Canon">Canon</option>
                <option value="Epson">Epson</option>
              </select>
            </div>
            <div>
              <label class="block font-medium mb-1">S·ªë l∆∞·ª£ng:</label>
              <input type="number" name="copies" min="1" value="1"
                class="w-full border border-gray-300 px-3 py-2 rounded-md" />
            </div>
            <!-- Truy·ªÅn l·∫°i filter n·∫øu c√≥ -->
            <input type="hidden" name="category" th:value="${param.category}" />
            <input type="hidden" name="fromDate" th:value="${param.fromDate}" />
            <input type="hidden" name="toDate" th:value="${param.toDate}" />
            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-md">
              In
            </button>
          </div>
        </form>
      </div>
    </div>
    <!-- Th√¥ng b√°o l·ªói/th√†nh c√¥ng khi xu·∫•t/in file -->
    <div th:if="${message}" class="mt-4 text-green-700 font-semibold text-center">[[${message}]]</div>
    <div th:if="${error}" class="mt-4 text-red-700 font-semibold text-center">[[${error}]]</div>
  </div>
</body>

<script>
  function validateDateFilter() {
    const from = document.getElementById('fromDate').value;
    const to = document.getElementById('toDate').value;
    const errorMsg = document.getElementById('dateErrorMsg');
    errorMsg.classList.add('hidden');
    if (from && to && from > to) {
      errorMsg.textContent = 'Ng√†y b·∫Øt ƒë·∫ßu ph·∫£i nh·ªè h∆°n ho·∫∑c b·∫±ng ng√†y k·∫øt th√∫c!';
      errorMsg.classList.remove('hidden');
      return false;
    }
    return true;
  }
</script>

</html>