<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
>
  <head>
    <meta charset="UTF-8" />
    <title>Quáº£n lÃ½ bÃ¡n hÃ ng</title>
  </head>
  <body>
    <div layout:fragment="content">
      <div class="space-y-6">
        <!-- TiÃªu Ä‘á» -->
        <h2 class="text-2xl font-bold text-[#4e342e]">ğŸ“‹ SÆ¡ Ä‘á»“ bÃ n</h2>

        <!-- Grid bÃ n -->
        <div class="grid grid-cols-5 gap-4 w-fit mx-auto">
          <div
            th:each="table : ${tables}"
            class="flex flex-col items-center justify-center aspect-square rounded-xl font-semibold text-center shadow-md w-24 p-2 transition duration-200"
            th:classappend="${table.status == 'AVAILABLE'}
             ? 'bg-green-100 text-green-800 hover:bg-green-200 cursor-pointer'
             : (${table.status == 'RESERVED'}
                ? 'bg-yellow-100 text-yellow-800'
                : 'bg-gray-300 text-gray-700 hover:bg-gray-400')"
          >
            <!-- Checkbox luÃ´n chá»n Ä‘Æ°á»£c -->
            <input
              type="checkbox"
              th:id="'table-' + ${table.id}"
              th:value="${table.id}"
              class="mb-1"
              name="selectedTable"
            />

            <!-- TÃªn bÃ n -->
            <label
              th:for="'table-' + ${table.id}"
              th:text="${table.tableName}"
            ></label>

            <!-- Tráº¡ng thÃ¡i cÃ³ icon -->
            <span class="text-xs mt-1 flex items-center gap-1">
              <span th:if="${table.status == 'AVAILABLE'}">ğŸŸ¢ Trá»‘ng</span>
              <span th:if="${table.status == 'OCCUPIED'}">ğŸ”´ Äang sá»­ dá»¥ng</span>
              <span th:if="${table.status == 'RESERVED'}">ğŸŸ¡ Äáº·t trÆ°á»›c</span>
            </span>
          </div>
        </div>

        <!-- CÃ¡c nÃºt thao tÃ¡c -->
        <div class="flex flex-wrap gap-3 justify-center mt-6">
          <a
            th:href="@{/sale/create}"
            class="inline-block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
          >
            â• ThÃªm bÃ n
          </a>
          <button
            type="button"
            onclick="showSelectedTables()"
            class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
          >
            ğŸ‘ï¸ Xem bÃ n
          </button>
          <button
            class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600"
          >
            Chuyá»ƒn bÃ n
          </button>
          <button
            class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600"
          >
            TÃ¡ch bÃ n
          </button>
          <button
            class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600"
          >
            Gá»™p bÃ n
          </button>
          <button
                  type="button"
                  class="bg-blue-600 text-white px-4 py-2 rounded"
                  onclick="redirectToReservationForm()"
          >
            Äáº·t bÃ n
          </button>
        </div>

        <!-- Menu, Thanh toÃ¡n, In -->
        <div class="grid grid-cols-3 gap-4 max-w-4xl mx-auto mt-4">
          <select class="border rounded px-3 py-2 col-span-1">
            <option>Chá»n thá»±c Ä‘Æ¡n...</option>
          </select>
          <button
            class="bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700"
          >
            ğŸ’³ Thanh toÃ¡n
          </button>
          <button
            class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700"
          >
            ğŸ–¨ï¸ In hÃ³a Ä‘Æ¡n
          </button>
        </div>
      </div>

      <!-- Modal hiá»ƒn thá»‹ chi tiáº¿t bÃ n -->
      <div
        id="detailModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
      >
        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md relative">
          <h2 class="text-xl font-bold mb-4">ğŸª‘ Chi tiáº¿t bÃ n</h2>
          <div id="modalContent" class="space-y-2">
            <p><strong>TÃªn bÃ n:</strong> <span id="tableName"></span></p>
            <p><strong>Tráº¡ng thÃ¡i:</strong> <span id="tableStatus"></span></p>
          </div>
          <button
            onclick="closeDetailModal()"
            class="absolute top-2 right-2 text-gray-500 hover:text-gray-700"
          >
            âœ–ï¸
          </button>
        </div>
      </div>

      <script>
        // xem thÃ´ng tin bÃ n
        // Chá»‰ cho phÃ©p chá»n 1 checkbox
        document.querySelectorAll("input[type=checkbox]").forEach((cb) => {
          cb.addEventListener("change", function () {
            if (this.checked) {
              document
                .querySelectorAll("input[type=checkbox]")
                .forEach((other) => {
                  if (other !== this) other.checked = false;
                });
            }
          });
        });

        function showSelectedTables() {
          const checkbox = document.querySelector(
            "input[type=checkbox]:checked"
          );
          if (!checkbox) {
            showWarning("Vui lÃ²ng chá»n má»™t bÃ n.");
            return;
          }
          const id = checkbox.value;
          fetch("/sale/api/view/" + id)
            .then((res) => {
              if (!res.ok) throw new Error("HTTP error " + res.status);
              return res.json();
            })
            .then((data) => {
              const modalContent = document.getElementById("modalContent");
              modalContent.innerHTML = `
            <p><strong>TÃªn bÃ n:</strong> ${data.tableName}</p>
            <p><strong>Tráº¡ng thÃ¡i:</strong> ${
                      data.status === "AVAILABLE"
                              ? "Trá»‘ng"
                              : data.status === "RESERVED"
                                      ? "Äáº·t trÆ°á»›c"
                                      : "Äang sá»­ dá»¥ng"
              }</p>
          `;
              document.getElementById("detailModal").classList.remove("hidden");
            })
            .catch((err) => {
              showError("KhÃ´ng thá»ƒ láº¥y dá»¯ liá»‡u bÃ n!");
            });
        }

        function closeDetailModal() {
          document.getElementById("detailModal").classList.add("hidden");
        }


        // Ä‘áº·t bÃ n
        function redirectToReservationForm() {
          const checked = document.querySelector('input[name="selectedTable"]:checked');
          if (!checked) {
            showWarning('Vui lÃ²ng chá»n má»™t bÃ n!');
            return;
          }
          // Láº¥y tráº¡ng thÃ¡i bÃ n tá»« DOM
          const tableDiv = checked.closest('div');
          const statusSpan = tableDiv.querySelector('.text-xs span');
          const statusText = statusSpan ? statusSpan.textContent.trim() : '';
          if (statusText !== "ğŸŸ¢ Trá»‘ng") {
            showWarning('Chá»‰ Ä‘Æ°á»£c Ä‘áº·t bÃ n khi bÃ n Ä‘ang trá»‘ng!');
            return;
          }
          window.location.href = '/sale/reservation?tableId=' + checked.value;
        }
      </script>
    </div>
  </body>
</html>
