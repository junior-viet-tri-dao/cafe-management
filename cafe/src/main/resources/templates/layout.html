<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="Cafe Management">Cafe Management</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>

    <!-- Optional JS utils -->
    <script th:src="@{/js/alert-utils.js}" defer></script>
</head>
<body class="d-flex flex-column min-vh-100">

<!-- Header -->
<header class="bg-dark text-white shadow-sm py-3">
    <div class="container d-flex justify-content-between align-items-center">
        <h1 class="h4 mb-0">‚òï C√°i Ti·ªám C√† Ph∆°</h1>

        <div class="d-flex align-items-center gap-3">
            <div class="text-end">
                <div class="fw-semibold" th:text="${user != null && user.username != null ? user.username : 'Guest'}">T√™n ƒëƒÉng nh·∫≠p</div>
                <div class="text-muted small" th:text="${user != null && user.permission != null ? user.permission : 'Admin'}">Ch·ª©c v·ª•</div>
            </div>
            <img th:src="${user != null && user.imageUrl != null ? user.imageUrl : '/images/default-avatar.png'}"
                 class="rounded-circle border" alt="avatar" width="40" height="40">
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="btn btn-sm btn-danger">ƒêƒÉng xu·∫•t</button>
            </form>
        </div>
    </div>
</header>

<!-- Layout: Sidebar + Content -->
<div class="d-flex flex-grow-1" style="min-height: 0;">
    <!-- Sidebar -->
    <aside class="bg-light border-end p-3" style="width: 250px;">
        <nav class="nav flex-column">
            <a th:href="@{/home}" class="nav-link" th:classappend="${currentPath == '/home'} ? 'fw-bold text-primary' : ''">üè† Trang ch·ªß</a>
            <a th:if="${user != null}"
               th:href="@{/account/profile/{id}(id=${user.id})}"
               class="nav-link"
               th:classappend="${currentPath == '/account'} ? 'fw-bold text-primary' : ''">
                üë§ Trang c√° nh√¢n
            </a>
            <a th:href="@{/sale}" class="nav-link" th:classappend="${currentPath == '/sale'} ? 'fw-bold text-primary' : ''">üíµ Qu·∫£n l√Ω b√°n h√†ng</a>

            <div th:if="${user.permission == 'ADMIN'}" class="mt-3">
                <hr>
                <strong class="text-uppercase small">Qu·∫£n l√Ω h·ªá th·ªëng</strong>

                <div class="accordion mt-2" id="adminMenu">

                    <!-- Qu·∫£n l√Ω nh√¢n vi√™n -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="employeeHeading">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#employeeCollapse">
                                üë• Nh√¢n vi√™n
                            </button>
                        </h2>
                        <div id="employeeCollapse" class="accordion-collapse collapse" data-bs-parent="#adminMenu">
                            <div class="accordion-body ps-3">
                                <a th:href="@{/employee}" class="d-block nav-link">Danh s√°ch</a>
                                <a th:href="@{/employee/new}" class="d-block nav-link">Th√™m m·ªõi</a>
                            </div>
                        </div>
                    </div>

                    <!-- Qu·∫£n l√Ω thi·∫øt b·ªã -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="equipmentHeading">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#equipmentCollapse">
                                üõ†Ô∏è Thi·∫øt b·ªã
                            </button>
                        </h2>
                        <div id="equipmentCollapse" class="accordion-collapse collapse" data-bs-parent="#adminMenu">
                            <div class="accordion-body ps-3">
                                <a th:href="@{/equipment}" class="d-block nav-link">Danh s√°ch</a>
                                <a th:href="@{/equipment/new}" class="d-block nav-link">Th√™m m·ªõi</a>
                            </div>
                        </div>
                    </div>

                    <!-- Qu·∫£n l√Ω kho -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="inventoryHeading">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#inventoryCollapse">
                                üì¶ Kho h√†ng
                            </button>
                        </h2>
                        <div id="inventoryCollapse" class="accordion-collapse collapse" data-bs-parent="#adminMenu">
                            <div class="accordion-body ps-3">
                                <a th:href="@{/inventory}" class="d-block nav-link">Danh s√°ch giao d·ªãch</a>
                                <button class="btn d-block nav-link" data-bs-toggle="modal" data-bs-target="#confirmProductExistModal">Nh·∫≠p h√†ng</button>
                                <a th:href="@{/inventory/export/create}" class="d-block nav-link">Xu·∫•t h√†ng</a>
                            </div>
                        </div>
                    </div>

                    <!-- Qu·∫£n l√Ω th·ª±c ƒë∆°n -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="menuHeading">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#menuCollapse">
                                üçΩÔ∏è Th·ª±c ƒë∆°n
                            </button>
                        </h2>
                        <div id="menuCollapse" class="accordion-collapse collapse" data-bs-parent="#adminMenu">
                            <div class="accordion-body ps-3">
                                <a th:href="@{/menuItem}" class="d-block nav-link">Danh s√°ch m√≥n</a>
                                <a th:href="@{/menuItem/new}" class="d-block nav-link">Th√™m m√≥n</a>
                            </div>
                        </div>
                    </div>

                    <!-- Qu·∫£n l√Ω marketing -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="marketingHeading">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#marketingCollapse">
                                üì¢ Marketing
                            </button>
                        </h2>
                        <div id="marketingCollapse" class="accordion-collapse collapse" data-bs-parent="#adminMenu">
                            <div class="accordion-body ps-3">
                                <a th:href="@{/promotion}" class="d-block nav-link">Danh s√°ch khuy·∫øn m√£i</a>
                                <a th:href="@{/promotion/new}" class="d-block nav-link">Th√™m khuy·∫øn m√£i</a>
                            </div>
                        </div>
                    </div>

                    <!-- Ng√¢n s√°ch -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="budgetHeading">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#budgetCollapse">
                                üìä Ng√¢n s√°ch
                            </button>
                        </h2>
                        <div id="budgetCollapse" class="accordion-collapse collapse" data-bs-parent="#adminMenu">
                            <div class="accordion-body ps-3">
                                <a th:href="@{/revenue}" class="d-block nav-link">Xem thu chi</a>
                                <a th:href="@{/expense/new}" class="d-block nav-link">Th√™m chi ti√™u</a>
                            </div>
                        </div>
                    </div>

                    <!-- B√°o c√°o & gi·ªõi thi·ªáu -->
                    <a th:href="@{/report}" class="nav-link mt-2">üìà Th·ªëng k√™</a>

                </div>
            </div>
            <a th:href="@{/about}" class="nav-link">‚ÑπÔ∏è Gi·ªõi thi·ªáu</a>
        </nav>
    </aside>

    <!-- N·ªôi dung ch√≠nh -->
    <main class="flex-grow-1 p-4 bg-light" layout:fragment="content">
        <div class="text-center mt-5">
            <h2 class="display-5 fw-bold text-dark" th:text="'Xin ch√†o, ' + (${user} != null ? ${user.username} : 'Guest')">Xin ch√†o</h2>
            <p class="mt-3 text-muted">Ch√∫c b·∫°n m·ªôt ng√†y l√†m vi·ªác hi·ªáu qu·∫£ v√† vui v·∫ª ‚òï‚ú®</p>
        </div>
    </main>
</div>

<!-- Modal x√°c nh·∫≠n -->
<div class="modal fade" id="confirmProductExistModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-3 shadow">
            <div class="modal-header">
                <h5 class="modal-title text-primary fw-bold">üì¶ H√†ng h√≥a ƒë√£ c√≥ trong kho ch∆∞a?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
            </div>
            <div class="modal-body">
                <p>B·∫°n vui l√≤ng ch·ªçn m·ªôt trong hai l·ª±a ch·ªçn b√™n d∆∞·ªõi ƒë·ªÉ ti·∫øp t·ª•c th√™m ƒë∆°n nh·∫≠p:</p>
                <ul>
                    <li><strong>Ch∆∞a c√≥</strong>: T·∫°o h√†ng h√≥a m·ªõi tr∆∞·ªõc khi nh·∫≠p.</li>
                    <li><strong>ƒê√£ c√≥</strong>: Nh·∫≠p h√†ng d·ª±a tr√™n s·∫£n ph·∫©m c√≥ s·∫µn.</li>
                </ul>
            </div>
            <div class="modal-footer justify-content-between">
                <a th:href="@{/product/new(redirectToImport=true)}" class="btn btn-outline-secondary">‚ûï Ch∆∞a c√≥</a>
                <a th:href="@{/inventory/import/new}" class="btn btn-primary">‚úÖ ƒê√£ c√≥</a>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-white text-center py-3 mt-auto">
    <p class="mb-0">2025 ¬© Cafe Management | Junior Vi·ªát Tr√≠ ƒê·∫°o</p>
</footer>

<!-- Alert component -->
<div th:replace="~{/alert :: alerts}"></div>
</body>
</html>
